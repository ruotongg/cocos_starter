{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["cc","Class","Component","properties","starPrefab","type","Prefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","onLoad","groundY","y","height","timer","starDuration","spawnNewStar","score","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","getComponent","game","Math","random","randX","randY","jumpHeight","maxX","width","v2","start","update","dt","gameOver","gainScore","string","audioEngine","playEffect","stopAllActions","director","loadScene"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        //这个属性引用了星星预置资源\r\n        starPrefab:{\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        //星星产生后消失时间的随机范围\r\n        maxStarDuration: 0,\r\n        minStarDuration: 0,\r\n\r\n        //地面节点，用于确定星星生成的高度\r\n        ground:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        //Player节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n        player:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        scoreDisplay:{\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        scoreAudio:{\r\n            default:null,\r\n            type: cc.AudioClip\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        //获取地平面的y轴坐标\r\n        this.groundY=this.ground.y+this.ground.height/2;\r\n        //初始化计时器\r\n        this.timer=0;\r\n        this.starDuration=0;\r\n\r\n        //生成一个新的星星\r\n        this.spawnNewStar();\r\n        //初始化计分\r\n        this.score=0;\r\n    },\r\n\r\n    spawnNewStar:function(){\r\n        //使用给定的模板在场景中生成一个新节点\r\n        var newStar=cc.instantiate(this.starPrefab);\r\n        //将新增的节点添加到Canvas节点下面\r\n        this.node.addChild(newStar);\r\n        //为星星设计一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n\r\n        //在星星脚本组件上保存Game对象的引用\r\n        newStar.getComponent('Star').game=this;\r\n\r\n        // 重置计时器，根据消失时间范围随机取一个值\r\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n    },\r\n\r\n    getNewStarPosition:function(){\r\n        var randX=0;\r\n        //根据地平面位置和主角跳跃高度，随机得到一个星星的y坐标\r\n        var randY=this.groundY+Math.random()*this.player.getComponent('Player').jumpHeight+50;\r\n        //根据屏幕宽度，随机得到一个星星的x坐标\r\n        var maxX=this.node.width/2;\r\n        randX=(Math.random()-0.5)*2*maxX;\r\n        //返回星星坐标\r\n        return cc.v2(randX,randY);\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        //每帧更新计时器，超过限度还没生成新的星星则调用失败逻辑\r\n        if (this.timer>this.starDuration){\r\n            this.gameOver();\r\n            return;\r\n        }\r\n\r\n        this.timer+=dt;\r\n    },\r\n\r\n    gainScore:function(){\r\n        this.score+=1;\r\n        //更新scoreDisplay的文字\r\n        this.scoreDisplay.string='Score: '+this.score;\r\n\r\n        //播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio,false);\r\n    },\r\n\r\n    gameOver:function(){\r\n        //停止Player节点的跳跃动作\r\n        this.player.stopAllActions();\r\n\r\n        //重新加载场景game\r\n        cc.director.loadScene('game');\r\n    },\r\n});\r\n"]}